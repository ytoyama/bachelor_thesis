\section{実験}

\subsection{実験設定}

実験は、各手法の正答率を測定するものと、提案手法における予測レーティングと
正解レーティングの平均二乗誤差(RMSE)を測定するものの2つを行った。
RMSEの計算において、正解または予測レーティングが0点であるものは評価から省いた。
比較手法として、
提案手法における分類器の入力をそれぞれ
(1) DV (Document Vector)、
(2) ASV (Averaged Sentence Vector)、
(3) Weighted ASV
に変えた手法を用いた。
DVとはレビュー全体の文書ベクトルであり、
Quocら\cite{quoc14}の手法に相当する。
ASVとはレビュー内で平均した文ベクトルであり、
Weighted ASVとはレビュー内で重み付け平均によって圧縮された文ベクトルである。
データセットとしては、先行研究\cite{fujitani15}と同様に、
ホテル予約サイト楽天トラベルにおけるレビュー337,266件からレビューの番号順に
訓練データ300,000件、開発データ10,000件、評価データ10,000件を用いた。
有意差検定にはマクネマー検定を用い、
p値が0.05より小さいとき有意とした。

%比較手法として、
%及び、提案手法における分類器の入力を変えた2つの手法、
%(1) Quocら\cite{quoc14}によるDV、
%(2) ASV (Averaged Sentence Vector)
%と
%(3) Weighted ASVを用いた。
%これらの手法と提案手法に用いる分類器の入力を
%表\ref{tab:MethodFeatures}に列挙する。

%\begin{table}
%  \caption{各手法に用いられる特徴量}
%  \centering
%  \begin{tabularx}{\linewidth}{l | X} \label{tab:MethodFeatures}
%    手法 & 特徴量 \\
%    \hline
%    DV & レビュー全体の文書ベクトル \\
%    \hline
%    ASV & レビュー内で平均した文ベクトル \\
%    \hline
%    Weighted ASV & レビュー内で重み付け平均によって圧縮された文ベクトル \\
%    \hline
%    提案手法 & レビュー全体の文書ベクトル、\\
%             & レビュー内で重み付け平均によって圧縮された文ベクトル \\
%  \end{tabularx}
%\end{table}

%ASVとWeighted ASVの比較によって、
%文の位置関係が分類に対して重要であるかが示される。
%基準手法と提案手法、また、Weighted ASVと提案手法の基準手法の比較によって、
%文書ベクトルと文ベクトルを同時に特徴量として用いることが
%有効であるかが示される。

表\ref{tab:ParametersOfMethods}に各手法におけるニューラルネットワークの
パラメータ設定を示す。
全ての手法において、中間層の数は1、入力層及び中間層におけるドロップアウト率は
それぞれ0.2と0.5で共通である。
Adam\cite{diederik15}のハイパーパラメータは\cite{diederik15}と同様の値を
用いた。
Weighted ASVと提案手法において圧縮された文ベクトルの数は
それぞれ3つと2つとした。
全ての実験において文書及び文ベクトルについては、
学習回数は1,024回、学習する単語の範囲は前3単語、単語の最少出現回数は5回、
ネガティブサンプリングの回数は5回、ベクトルの次元数は600次元に
設定し学習したものを用いた。

\begin{table}
  \caption{各手法のパラメータ設定}
  \centering
  \begin{tabular}{l | r r} \label{tab:ParametersOfMethods}
    手法 & 学習回数 & 中間層でのユニット数 \\
    \hline
    DV & 20 & 512 \\
    ASV & 55 & 256 \\
    Weighted ASV & 24 & 256 \\
    提案手法 & 30 & 512 \\
  \end{tabular}
\end{table}

レビューに対する前処理について以下に示す。
まず、レビューの文書に対して、文字の正規化処理を行った。
記号「！”＃＄％＆’（）＊＋，−．／：；＜＞？＠［￥］＾＿｀｛｜｝
\unicode{301C}」は全てNFKC形式で正規化した。
記号「\unicode{02D7}\unicode{058A}\unicode{2011}\unicode{2012}\unicode{2013}
\unicode{2043}\unicode{207B}\unicode{208B}\unicode{2212}」
は全て記号「-」で置き換えた。
記号「\unicode{FE63}－ｰ—―─━ー」は全て記号「ー」で置き換えた。
チルダ記号「\unicode{007E}\unicode{223C}\unicode{223E}\unicode{301C}
\unicode{3030}\unicode{FF5E}」は全て削除した。
次に、文の解析は正規表現を用いて行った。
「。」、「.」、「!」、「?」を文の終端文字とし、
解析した最後の文の次の文字から
文の終端文字または文書の終端までを一つの文として解析した。
最後に、形態素解析には形態素解析器MeCabを用いた、
辞書にはIPA辞書を用いた。
単語の情報は表層のみを利用し、表層が無いものは取り除いた。


\subsection{結果}

まず、提案手法と3つの比較手法、従来手法\cite{fujitani15}を
正答率で比較したものを表\ref{tab:Accuracies}に示す。
また、表\ref{tab:AccuraciesPerCategory}に提案手法と
従来手法\cite{fujitani15}におけるカテゴリ別の正答率を示す。
表\ref{tab:Accuracies}において、
提案手法が従来手法\cite{fujitani15}の正答率を0.0198有意に上回っている。
また、提案手法がDVの正答率を0.0050有意に上回っている。
Weighted ASVがASVを0.029有意に上回っている。

\begin{table}
  \caption{各手法における正答率}
  \centering
  \begin{tabular}{l | r} \label{tab:Accuracies}
    手法 & 正答率 \\
    \hline
    従来手法\cite{fujitani15} & 0.4832 \\
    DV & 0.4980 \\
    ASV & 0.4838 \\
    Weighted ASV & 0.4867 \\
    提案手法 & \textbf{0.5030} \\
  \end{tabular}
\end{table}

\begin{table}
  \caption{提案手法と従来手法\cite{fujitani15}におけるカテゴリ別の正答率}
  \centering
  \begin{tabular}{l | r r r r r r r} \label{tab:AccuraciesPerCategory}
    手法 & 立地 & 部屋 & 食事 & 風呂 & サービス & 設備 & 総合 \\
    \hline
    提案手法 & 0.5140 & 0.4984 & 0.5353 & 0.4347 & 0.5116 & 0.4479 & 0.5794 \\
    従来手法\cite{fujitani15}
        & 0.4961 & 0.4706 & 0.5140 & 0.3973 & 0.4783 & 0.4265 & 0.5660 \\
  \end{tabular}
\end{table}

次に、表\ref{tab:RMSEs}にレーティングのRMSEを測定した結果を示す。
提案手法は従来手法\cite{fujitani15}が弱点としていた
食事と風呂のカテゴリにおいてそれぞれ0.60及び0.24だけ低い誤差を示した。
また、その他全てのカテゴリにおいても提案手法は従来手法より低い誤差を示した。

\begin{table}
  \caption{提案手法と従来手法\cite{fujitani15}におけるレーティングのRMSE}
  \centering
  \begin{tabular}{l | r r} \label{tab:RMSEs}
    手法 & 提案手法 & 従来手法\cite{fujitani15} \\
    \hline
    立地      & 0.88 & 0.97 \\
    部屋      & 0.88 & 0.97 \\
    食事      & 0.93 & 1.53 \\
    風呂      & 1.03 & 1.27 \\
    サービス  & 0.86 & 0.94 \\
    設備      & 0.90 & 0.95 \\
    総合      & 0.73 & 0.81 \\
  \end{tabular}
\end{table}

最後に、正答率を測定する実験における提案手法の精度と再現率、F値を
それぞれ表\ref{tab:ProposedMethodPrecision}と
表\ref{tab:ProposedMethodRecall}、表\ref{tab:ProposedMethodFValue}に示す。
表においてnanは0による除算が発生し計算できなかったことを示す。

\begin{table}
  \caption{提案手法の精度}
  \centering
  \begin{tabular}{l | r r r r r r r | r} \label{tab:ProposedMethodPrecision}
    レーティング & 立地 & 部屋 & 食事 & 風呂 & サービス & 設備 & 総合
      & 全カテゴリ \\
    \hline
    \csvreader[no head,late after line=\\]
      {csv/class_precision.csv}
      {1=\rating,2=\location,3=\room,4=\mean,5=\bath,6=\service,7=\facilities,
       8=\overall,9=\allcategories}
      {\rating & \location & \room & \mean & \bath & \service & \facilities
       & \overall & \allcategories}
  \end{tabular}
\end{table}

\begin{table}
  \caption{提案手法の再現率}
  \centering
  \begin{tabular}{l | r r r r r r r | r} \label{tab:ProposedMethodRecall}
    レーティング & 立地 & 部屋 & 食事 & 風呂 & サービス & 設備 & 総合
      & 全カテゴリ \\
    \hline
    \csvreader[no head,late after line=\\]
      {csv/class_recall.csv}
      {1=\rating,2=\location,3=\room,4=\mean,5=\bath,6=\service,7=\facilities,
       8=\overall,9=\allcategories}
      {\rating & \location & \room & \mean & \bath & \service & \facilities
       & \overall & \allcategories}
  \end{tabular}
\end{table}

\begin{table}
  \caption{提案手法のF値}
  \centering
  \begin{tabular}{l | r r r r r r r | r} \label{tab:ProposedMethodFValue}
    レーティング & 立地 & 部屋 & 食事 & 風呂 & サービス & 設備 & 総合
      & 全カテゴリ \\
    \hline
    \csvreader[no head,late after line=\\]
      {csv/class_f_value.csv}
      {1=\rating,2=\location,3=\room,4=\mean,5=\bath,6=\service,7=\facilities,
       8=\overall,9=\allcategories}
      {\rating & \location & \room & \mean & \bath & \service & \facilities
       & \overall & \allcategories}
  \end{tabular}
\end{table}
